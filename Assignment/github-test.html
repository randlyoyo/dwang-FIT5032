<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GitHub Login Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      button {
        background: #333;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #555;
      }
      .error {
        color: red;
        background: #ffe6e6;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .success {
        color: green;
        background: #e6ffe6;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      .info {
        color: blue;
        background: #e6f3ff;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>GitHub Login Test</h1>

    <div class="test-section">
      <h2>Firebase Configuration</h2>
      <div id="firebase-config"></div>
    </div>

    <div class="test-section">
      <h2>GitHub Login Test</h2>
      <button onclick="testGitHubLogin()">Test GitHub Login</button>
      <div id="github-result"></div>
    </div>

    <div class="test-section">
      <h2>Debug Information</h2>
      <div id="debug-info"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js'
      import {
        getAuth,
        signInWithPopup,
        GithubAuthProvider,
      } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js'

      // Firebase配置
      const firebaseConfig = {
        apiKey: 'AIzaSyCiHLtSu1gPIw_EAa4DUQbK5RGJA_gXkdE',
        authDomain: 'assignment-cfc8f.firebaseapp.com',
        projectId: 'assignment-cfc8f',
        storageBucket: 'assignment-cfc8f.firebasestorage.app',
        messagingSenderId: '838358223615',
        appId: '1:838358223615:web:aedd47372fe13c28649aca',
        measurementId: 'G-JYQKQDTYTM',
      }

      // 初始化Firebase
      const app = initializeApp(firebaseConfig)
      const auth = getAuth(app)

      // 显示Firebase配置
      document.getElementById('firebase-config').innerHTML = `
            <div class="info">
                <strong>Project ID:</strong> ${firebaseConfig.projectId}<br>
                <strong>Auth Domain:</strong> ${firebaseConfig.authDomain}<br>
                <strong>API Key:</strong> ${firebaseConfig.apiKey.substring(0, 20)}...<br>
            </div>
        `

      // 测试GitHub登录
      window.testGitHubLogin = async function () {
        const resultDiv = document.getElementById('github-result')
        const debugDiv = document.getElementById('debug-info')

        try {
          resultDiv.innerHTML = '<div class="info">Attempting GitHub login...</div>'
          debugDiv.innerHTML = ''

          const provider = new GithubAuthProvider()
          provider.addScope('user:email')
          provider.addScope('read:user')

          console.log('GitHub Provider:', provider)
          console.log('Provider Scopes:', provider.scopes)
          console.log('Auth Instance:', auth)

          const result = await signInWithPopup(auth, provider)
          const user = result.user

          resultDiv.innerHTML = `
                    <div class="success">
                        <strong>GitHub Login Successful!</strong><br>
                        <strong>User ID:</strong> ${user.uid}<br>
                        <strong>Email:</strong> ${user.email}<br>
                        <strong>Display Name:</strong> ${user.displayName}<br>
                        <strong>Photo URL:</strong> ${user.photoURL}<br>
                        <strong>Email Verified:</strong> ${user.emailVerified}
                    </div>
                `

          debugDiv.innerHTML = `
                    <div class="info">
                        <strong>Debug Information:</strong><br>
                        <strong>Provider:</strong> ${provider.providerId}<br>
                        <strong>Scopes:</strong> ${provider.scopes.join(', ')}<br>
                        <strong>User UID:</strong> ${user.uid}<br>
                        <strong>Provider Data:</strong> ${JSON.stringify(user.providerData, null, 2)}
                    </div>
                `
        } catch (error) {
          console.error('GitHub login error:', error)

          resultDiv.innerHTML = `
                    <div class="error">
                        <strong>GitHub Login Failed!</strong><br>
                        <strong>Error Code:</strong> ${error.code}<br>
                        <strong>Error Message:</strong> ${error.message}<br>
                    </div>
                `

          debugDiv.innerHTML = `
                    <div class="error">
                        <strong>Debug Information:</strong><br>
                        <strong>Error Code:</strong> ${error.code}<br>
                        <strong>Error Message:</strong> ${error.message}<br>
                        <strong>Full Error:</strong> ${JSON.stringify(error, null, 2)}<br>
                        <strong>Auth Instance:</strong> ${JSON.stringify(auth, null, 2)}
                    </div>
                `
        }
      }

      // 显示调试信息
      document.getElementById('debug-info').innerHTML = `
            <div class="info">
                <strong>Current URL:</strong> ${window.location.href}<br>
                <strong>User Agent:</strong> ${navigator.userAgent}<br>
                <strong>Firebase App:</strong> ${app.name}<br>
                <strong>Auth Instance:</strong> ${auth.app.name}
            </div>
        `
    </script>
  </body>
</html>
